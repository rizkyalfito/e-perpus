<?php session_start(); include "../../../../config/koneksi.php"; if ($_GET['aksi'] == "pinjam") { $nama_anggota = $_POST['namaAnggota']; $judul_buku = $_POST['judulBuku']; $tanggal_peminjaman = $_POST['tanggalPeminjaman']; $kondisi_buku_saat_dipinjam = $_POST['kondisiBukuSaatDipinjam']; $query = mysqli_query($koneksi, "SELECT * FROM peminjaman WHERE nama_anggota = '$nama_anggota' AND judul_buku = '$judul_buku' AND tanggal_pengembalian = ''"); $cek = mysqli_num_rows($query); if ($cek > 0) { $_SESSION['gagal'] = "Peminjaman buku gagal, Anggota telah meminjam buku ini sebelumnya !"; header("location: " . $_SERVER['HTTP_REFERER']); } else { $sql = "INSERT INTO peminjaman(nama_anggota,judul_buku,tanggal_peminjaman,kondisi_buku_saat_dipinjam) VALUES('" . $nama_anggota . "','" . $judul_buku . "','" . $tanggal_peminjaman . "','" . $kondisi_buku_saat_dipinjam . "')"; $sql .= mysqli_query($koneksi, $sql); if ($sql) { $_SESSION['berhasil'] = "Peminjaman buku berhasil ditambahkan oleh admin!"; header("location: " . $_SERVER['HTTP_REFERER']); } else { $_SESSION['gagal'] = "Terjadi masalah dalam pengiriman data peminjaman oleh admin!"; header("location: " . $_SERVER['HTTP_REFERER']); } } } elseif ($_GET['aksi'] == "pengembalian") { if ($_POST['kondisiBukuSaatDikembalikan'] == "Baik") { $denda = "Tidak ada"; } elseif ($_POST['kondisiBukuSaatDikembalikan'] == "Rusak") { $denda = "Rp 20.000"; } elseif ($_POST['kondisiBukuSaatDikembalikan'] == "Hilang") { $denda = "Rp 50.000"; } $judul_buku = $_POST['judulBuku']; $tanggal_pengembalian = $_POST['tanggalPengembalian']; $kondisiBukuSaatDikembalikan = $_POST['kondisiBukuSaatDikembalikan']; $ambil_id = mysqli_query($koneksi, "SELECT * FROM peminjaman WHERE judul_buku = '$judul_buku' AND tanggal_pengembalian = ''"); $row = mysqli_fetch_assoc($ambil_id); $id_peminjaman = $row['id_peminjaman']; $query = "UPDATE peminjaman SET tanggal_pengembalian = '$tanggal_pengembalian', kondisi_buku_saat_dikembalikan = '$kondisiBukuSaatDikembalikan', denda = '$denda'"; $query .= " WHERE id_peminjaman = $id_peminjaman"; $sql = mysqli_query($koneksi, $query); if ($sql) { $_SESSION['berhasil'] = "Pengembalian buku berhasil ditambahkan oleh admin!"; header("location: " . $_SERVER['HTTP_REFERER']); } else { $_SESSION['gagal'] = "Pengembalian buku gagal ditambahkan oleh admin!"; header("location: " . $_SERVER['HTTP_REFERER']); } }